{% load i18n %}
<!-- Maintenance Notification Indicator -->
<div class="maintenance-notification-indicator">
    <a href="{% url 'plugins:netbox_maintenance_device:notifications' %}" 
       class="btn btn-outline-secondary btn-sm position-relative" 
       title="{% trans 'Maintenance Notifications' %}">
        <i class="mdi mdi-bell"></i>
        {% if unread_count > 0 %}
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                {{ unread_count }}
            </span>
        {% endif %}
    </a>
</div>

<script>
// Simple notification check
document.addEventListener('DOMContentLoaded', function() {
    // Request notification permission
    if ('Notification' in window && Notification.permission === 'default') {
        Notification.requestPermission();
    }
    
    // Check for notifications every 5 minutes
    setInterval(function() {
        checkNotifications();
    }, 300000); // 5 minutes
});

function checkNotifications() {
    fetch('{% url "plugins:netbox_maintenance_device:api_unread_notifications" %}')
        .then(response => response.json())
        .then(data => {
            if (data.count > 0 && 'Notification' in window && Notification.permission === 'granted') {
                data.notifications.forEach(function(notification) {
                    if (notification.priority === 'critical') {
                        new Notification('NetBox - Manutenção Crítica', {
                            body: notification.message,
                            tag: 'maintenance-' + notification.id
                        });
                    }
                });
            }
        })
        .catch(error => console.log('Notification check failed:', error));
}
</script>
